# HDFS-问答题

### 一、描述一下HDFS的数据写入流程

​		以从本地向HDFS写入一个200M的文件为例，客户端通过DistributedFileSystem向nn发起请求上传文件，nn接收到请求后会检查要写入的目录是否存在，是否有写入操作的权限，检查通过后，返回给客户端可以上传文件，客户端接收到后，将文件分块，开始请求上传第一个块的服务器，nn收到请求后返回给客户端把文件块分配到哪几个dn上，客户端接收到后，通过FSDataOutputStream模板请求dn1上传数据，dn1收到请求会继续发送给dn2,dn2收到会继续发给dn3,当所有dn都接收到请求后，会依次响应到客户端，成功建立通信通道。客户端开始向dn1上传第一个块，将一个块分成多个packet进行传输，大小为64k，dn1每收到一个packet会继续向下传递，同时执行写入操作，将packet写入到磁盘中，当第一个块传输完成后，客户端再次请求上传第二个块的服务器。

### 二、描述一下HDFS的数据读取流程

​		客户端通过DistributedFileSystem向nn请求下载文件，nn通过查找元数据，找到了要下载的文件块的地址，将元数据返回给客户端，客户端调用FSDatainputStream向离客户端最近的存储文件块的dn请求读取数据，请求通过后，dn开始从磁盘里读取数据，以packet为单位传输数据给客户端，客户端以packet为单位接收，按文件块的顺序写入到目标文件。

### 三、简述HDFS的架构，其中每个服务的作用

NameNode:hdfs的老大，管理HDFS的名称空间，配置副本策略，管理元数据，与客户端进行通信

DataNode:员工，存储真实数据块，执行数据块的读写操作

Client：客户端，文件切分，与nn交互获取元数据，执行读写操作，通过命令管理HDFS

SecondaryNameNode：秘书，帮nn分担压力，定期合并FsImage和Edits并推送给nn，可辅助恢复nn

### 四、HDFS中如何实现元数据的维护？

在磁盘和内存都存储了元数据，FsImage的元数据存储在磁盘中，Edits在内存中记录对元数据的操作，2nn定期将FsImage和Edits进行合并后推送给nn，保证了元数据的安全性和高效性

### 五、2NN如何对NN的元数据进行合并

第一次启动nn格式化后，nn自己会将FsImage和Edits进行一次合并

每隔一个小时2nn就会合并一次nn的FsImage和Edits，合并之前向通知nn，nn会停止Edits的追加操作，创建新的Edits文件，保证nn正常工作，2nn将FsImage和Edits读取到本地进行合并，把合并后的新的FsImage发送给nn的本地，2nn自己也会备份一份；当edits操作次数达到100万次，不管时间有没有到1小时，都会进行合并

### 六、描述一下NN和DN的关系，以及DN的工作流程

老板和员工的关系，DN存储真实数据以及元数据

DN首先会向NN注册，每六个小时扫描节点块信息列表并向NN发送一次所有块的信息，每三秒向NN发送一次心跳，如果NN超过10分30秒没有收到DN的心跳，认为该节点不可用